<html class="scroll-smooth" lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   EcoFinds - Sustainable Second-Hand Marketplace
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Inter', sans-serif;
    }
  </style>
 </head>
 <body class="bg-gray-50 min-h-screen flex flex-col">
  <div class="flex-grow flex flex-col" id="app">
   <!-- Navigation -->
   <nav class="bg-white shadow-md sticky top-0 z-30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="flex justify-between h-16 items-center">
      <a class="flex items-center space-x-2" href="#">
       <img alt="EcoFinds logo, stylized leaf with EF letters in green" class="h-10 w-10 rounded-full" height="40" src="https://storage.googleapis.com/a1aa/image/f4c7420e-7b76-4e39-9215-9a9a7c067526.jpg" width="40"/>
       <span class="text-xl font-semibold text-green-700 select-none">
        EcoFinds
       </span>
      </a>
      <div class="hidden md:flex items-center space-x-6 text-gray-700 font-medium">
       <button class="nav-link hover:text-green-700 focus:outline-none focus:text-green-700" data-nav="feed">
        Feed
       </button>
       <button class="nav-link hover:text-green-700 focus:outline-none focus:text-green-700" data-nav="mylistings">
        My Listings
       </button>
       <button class="nav-link hover:text-green-700 focus:outline-none focus:text-green-700" data-nav="dashboard">
        Dashboard
       </button>
       <button class="nav-link hover:text-green-700 focus:outline-none focus:text-green-700" data-nav="cart">
        Cart
       </button>
       <button class="nav-link hover:text-green-700 focus:outline-none focus:text-green-700" data-nav="purchases">
        Previous Purchases
       </button>
       <button class="text-red-600 hover:text-red-800 focus:outline-none font-semibold" id="logoutBtn">
        Logout
       </button>
      </div>
      <div class="md:hidden">
       <button aria-label="Open menu" class="text-gray-700 hover:text-green-700 focus:outline-none focus:text-green-700" id="mobileMenuBtn">
        <i class="fas fa-bars fa-lg">
        </i>
       </button>
      </div>
     </div>
    </div>
    <div class="hidden md:hidden bg-white border-t border-gray-200" id="mobileMenu">
     <div class="flex flex-col space-y-1 px-4 py-2">
      <button class="nav-link-mobile text-left py-2 px-2 rounded hover:bg-green-100 focus:outline-none focus:bg-green-100" data-nav="feed">
       Feed
      </button>
      <button class="nav-link-mobile text-left py-2 px-2 rounded hover:bg-green-100 focus:outline-none focus:bg-green-100" data-nav="mylistings">
       My Listings
      </button>
      <button class="nav-link-mobile text-left py-2 px-2 rounded hover:bg-green-100 focus:outline-none focus:bg-green-100" data-nav="dashboard">
       Dashboard
      </button>
      <button class="nav-link-mobile text-left py-2 px-2 rounded hover:bg-green-100 focus:outline-none focus:bg-green-100" data-nav="cart">
       Cart
      </button>
      <button class="nav-link-mobile text-left py-2 px-2 rounded hover:bg-green-100 focus:outline-none focus:bg-green-100" data-nav="purchases">
       Previous Purchases
      </button>
      <button class="text-left py-2 px-2 rounded text-red-600 hover:bg-red-100 focus:outline-none focus:bg-red-100 font-semibold" id="logoutBtnMobile">
       Logout
      </button>
     </div>
    </div>
   </nav>
   <!-- Main Content -->
   <main class="flex-grow max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-6">
    <!-- Login/Sign Up Screen -->
    <section aria-label="Login and Sign Up Screen" class="max-w-md mx-auto mt-20 bg-white rounded-lg shadow-md p-8" id="loginScreen">
     <div class="flex flex-col items-center mb-6">
      <img alt="EcoFinds logo, stylized leaf with EF letters in green" class="mb-4 rounded-full" height="80" src="https://storage.googleapis.com/a1aa/image/f4c7420e-7b76-4e39-9215-9a9a7c067526.jpg" width="80"/>
      <h1 class="text-2xl font-semibold text-green-700 mb-2">
       Welcome to EcoFinds
      </h1>
      <p class="text-gray-600">
       Empowering Sustainable Consumption
      </p>
     </div>
     <form class="space-y-5" id="loginForm" novalidate="">
      <div>
       <label class="block text-gray-700 font-medium mb-1" for="email">
        Email
       </label>
       <input autocomplete="username" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" id="email" name="email" placeholder="you@example.com" required="" type="email"/>
      </div>
      <div>
       <label class="block text-gray-700 font-medium mb-1" for="password">
        Password
       </label>
       <input autocomplete="current-password" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" id="password" name="password" placeholder="Enter your password" required="" type="password"/>
      </div>
      <button class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" type="submit">
       Log In
      </button>
     </form>
     <p class="mt-4 text-center text-gray-600">
      Don't have an account?
      <button class="text-green-600 font-semibold hover:underline focus:outline-none" id="showSignUpBtn">
       Sign Up
      </button>
     </p>
    </section>
    <!-- Sign Up Screen -->
    <section aria-label="Sign Up Screen" class="max-w-md mx-auto mt-20 bg-white rounded-lg shadow-md p-8 hidden" id="signUpScreen">
     <div class="flex flex-col items-center mb-6">
      <img alt="EcoFinds logo, stylized leaf with EF letters in green" class="mb-4 rounded-full" height="80" src="https://storage.googleapis.com/a1aa/image/f4c7420e-7b76-4e39-9215-9a9a7c067526.jpg" width="80"/>
      <h1 class="text-2xl font-semibold text-green-700 mb-2">
       Create an Account
      </h1>
      <p class="text-gray-600">
       Join the EcoFinds community
      </p>
     </div>
     <form class="space-y-5" id="signUpForm" novalidate="">
      <div>
       <label class="block text-gray-700 font-medium mb-1" for="signupEmail">
        Email
       </label>
       <input autocomplete="email" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" id="signupEmail" name="signupEmail" placeholder="you@example.com" required="" type="email"/>
      </div>
      <div>
       <label class="block text-gray-700 font-medium mb-1" for="signupUsername">
        Username
       </label>
       <input class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" id="signupUsername" maxlength="20" minlength="3" name="signupUsername" placeholder="Choose a username" required="" type="text"/>
      </div>
      <div>
       <label class="block text-gray-700 font-medium mb-1" for="signupPassword">
        Password
       </label>
       <input autocomplete="new-password" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" id="signupPassword" minlength="6" name="signupPassword" placeholder="Create a password" required="" type="password"/>
      </div>
      <button class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" type="submit">
       Sign Up
      </button>
     </form>
     <p class="mt-4 text-center text-gray-600">
      Already have an account?
      <button class="text-green-600 font-semibold hover:underline focus:outline-none" id="showLoginBtn">
       Log In
      </button>
     </p>
    </section>
    <!-- Product Listing Feed Screen -->
    <section aria-label="Product Listing Feed Screen" class="hidden flex flex-col" id="feedScreen">
     <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4">
      <h2 class="text-3xl font-bold text-green-700 mb-3 sm:mb-0 select-none">
       EcoFinds
      </h2>
      <div class="flex items-center space-x-3 w-full sm:w-auto">
       <input aria-label="Search products by title" class="flex-grow sm:flex-grow-0 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" id="searchInput" placeholder="Search products..." type="search"/>
       <select aria-label="Filter products by category" class="border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" id="categoryFilter">
        <option value="">
         All Categories
        </option>
        <option value="Clothing">
         Clothing
        </option>
        <option value="Electronics">
         Electronics
        </option>
        <option value="Books">
         Books
        </option>
        <option value="Furniture">
         Furniture
        </option>
        <option value="Toys">
         Toys
        </option>
        <option value="Accessories">
         Accessories
        </option>
        <option value="Sports">
         Sports
        </option>
        <option value="Other">
         Other
        </option>
       </select>
       <button aria-label="Add new product listing" class="ml-auto bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center space-x-2" id="addNewProductBtn">
        <i class="fas fa-plus">
        </i>
        <span>
         Add
        </span>
       </button>
      </div>
     </header>
     <ul aria-live="polite" aria-relevant="additions removals" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6" id="productList">
      <!-- Product items inserted here dynamically -->
     </ul>
    </section>
    <!-- Add New Product Screen -->
    <section aria-label="Add New Product Screen" class="hidden max-w-lg mx-auto bg-white rounded-lg shadow-md p-6" id="addProductScreen">
     <div class="flex items-center mb-6">
      <button aria-label="Back to feed" class="text-green-600 hover:text-green-800 focus:outline-none mr-3" id="backFromAddProductBtn">
       <i class="fas fa-arrow-left fa-lg">
       </i>
      </button>
      <h2 class="text-2xl font-semibold text-green-700">
       Add New Product
      </h2>
     </div>
     <form class="space-y-5" id="addProductForm" novalidate="">
      <div>
       <label class="block text-gray-700 font-medium mb-1" for="productTitle">
        Product Title
       </label>
       <input class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" id="productTitle" maxlength="100" name="productTitle" placeholder="Enter product title" required="" type="text"/>
      </div>
      <div>
       <label class="block text-gray-700 font-medium mb-1" for="productCategory">
        Category
       </label>
       <select class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" id="productCategory" name="productCategory" required="">
        <option disabled="" selected="" value="">
         Select category
        </option>
        <option value="Clothing">
         Clothing
        </option>
        <option value="Electronics">
         Electronics
        </option>
        <option value="Books">
         Books
        </option>
        <option value="Furniture">
         Furniture
        </option>
        <option value="Toys">
         Toys
        </option>
        <option value="Accessories">
         Accessories
        </option>
        <option value="Sports">
         Sports
        </option>
        <option value="Other">
         Other
        </option>
       </select>
      </div>
      <div>
       <label class="block text-gray-700 font-medium mb-1" for="productDescription">
        Description
       </label>
       <textarea class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" id="productDescription" maxlength="500" name="productDescription" placeholder="Enter product description" required="" rows="4"></textarea>
      </div>
      <div>
       <label class="block text-gray-700 font-medium mb-1" for="productPrice">
        Price (USD)
       </label>
       <input class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" id="productPrice" min="0" name="productPrice" placeholder="Enter price" required="" step="0.01" type="number"/>
      </div>
      <div>
       <label class="block text-gray-700 font-medium mb-1">
        Product Image
       </label>
       <div class="flex items-center space-x-4">
        <img alt="Placeholder image for product to be added" class="w-24 h-24 object-cover rounded border border-gray-300" height="100" id="productImagePreview" src="https://storage.googleapis.com/a1aa/image/daf5f6c9-ac41-4e58-45a3-9e1b86c9be81.jpg" width="100"/>
        <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center space-x-2" id="addImageBtn" type="button">
         <i class="fas fa-plus">
         </i>
         <span>
          Add Image (Placeholder)
         </span>
        </button>
       </div>
      </div>
      <button class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" type="submit">
       Submit Listing
      </button>
     </form>
    </section>
    <!-- My Listings Screen -->
    <section aria-label="My Listings Screen" class="hidden flex flex-col" id="myListingsScreen">
     <header class="flex items-center justify-between mb-4">
      <h2 class="text-3xl font-bold text-green-700 select-none">
       My Listings
      </h2>
      <button aria-label="Add new product listing" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center space-x-2" id="addNewProductBtnFromMyListings">
       <i class="fas fa-plus">
       </i>
       <span>
        Add
       </span>
      </button>
     </header>
     <ul aria-live="polite" aria-relevant="additions removals" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6" id="myProductList">
      <!-- User's product items inserted here dynamically -->
     </ul>
    </section>
    <!-- Product Detail Screen -->
    <section aria-label="Product Detail Screen" class="hidden max-w-3xl mx-auto bg-white rounded-lg shadow-md p-6" id="productDetailScreen">
     <div class="flex items-center mb-6">
      <button aria-label="Back to feed" class="text-green-600 hover:text-green-800 focus:outline-none mr-3" id="backFromProductDetailBtn">
       <i class="fas fa-arrow-left fa-lg">
       </i>
      </button>
      <h2 class="text-2xl font-semibold text-green-700 flex-grow" id="detailProductTitle">
      </h2>
      <button class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 flex items-center space-x-2 ml-4" id="addToCartBtn">
       <i class="fas fa-shopping-cart">
       </i>
       <span>
        Add to Cart
       </span>
      </button>
     </div>
     <img alt="Large placeholder image of the selected product" class="w-full h-64 object-cover rounded-md mb-4 border border-gray-300" height="400" id="detailProductImage" src="https://storage.googleapis.com/a1aa/image/a0ed24fe-9506-4849-b2b3-17096f2e9b77.jpg" width="600"/>
     <div class="mb-2">
      <span class="font-semibold text-gray-700">
       Price:
      </span>
      <span class="text-green-700 font-bold text-lg" id="detailProductPrice">
      </span>
     </div>
     <div class="mb-2">
      <span class="font-semibold text-gray-700">
       Category:
      </span>
      <span class="text-gray-600" id="detailProductCategory">
      </span>
     </div>
     <div>
      <span class="font-semibold text-gray-700">
       Description:
      </span>
      <p class="mt-1 text-gray-700 whitespace-pre-line" id="detailProductDescription">
      </p>
     </div>
    </section>
    <!-- User Dashboard -->
    <section aria-label="User Dashboard Screen" class="hidden max-w-lg mx-auto bg-white rounded-lg shadow-md p-6" id="dashboardScreen">
     <header class="flex items-center mb-6">
      <h2 class="text-3xl font-bold text-green-700 select-none flex-grow">
       User Dashboard
      </h2>
      <button class="text-red-600 hover:text-red-800 focus:outline-none font-semibold" id="logoutBtnDashboard">
       Logout
      </button>
     </header>
     <div class="flex flex-col items-center mb-6">
      <img alt="User avatar placeholder image, generic person silhouette" class="rounded-full border border-gray-300 mb-4" height="100" id="userAvatar" src="https://storage.googleapis.com/a1aa/image/309b7138-e477-4aaa-aa91-f87ab1bb9446.jpg" width="100"/>
     </div>
     <form class="space-y-5" id="dashboardForm" novalidate="">
      <div>
       <label class="block text-gray-700 font-medium mb-1" for="dashboardEmail">
        Email
       </label>
       <input class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 cursor-not-allowed" id="dashboardEmail" name="dashboardEmail" readonly="" type="email"/>
      </div>
      <div>
       <label class="block text-gray-700 font-medium mb-1" for="dashboardUsername">
        Username
       </label>
       <input class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500" id="dashboardUsername" maxlength="20" minlength="3" name="dashboardUsername" required="" type="text"/>
      </div>
      <button class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500" type="submit">
       Save Changes
      </button>
     </form>
    </section>
    <!-- Cart Screen -->
    <section aria-label="Cart Screen" class="hidden flex flex-col max-w-4xl mx-auto" id="cartScreen">
     <header class="flex items-center justify-between mb-4">
      <h2 class="text-3xl font-bold text-green-700 select-none">
       Cart
      </h2>
      <button class="text-red-600 hover:text-red-800 focus:outline-none font-semibold" id="clearCartBtn">
       Clear Cart
      </button>
     </header>
     <ul class="space-y-4" id="cartList">
      <!-- Cart product cards inserted here dynamically -->
     </ul>
     <div class="text-center text-gray-600 mt-10" id="cartEmptyMessage">
      Your cart is empty.
     </div>
    </section>
    <!-- Previous Purchases Screen -->
    <section aria-label="Previous Purchases Screen" class="hidden flex flex-col max-w-4xl mx-auto" id="purchasesScreen">
     <header class="flex items-center justify-between mb-4">
      <h2 class="text-3xl font-bold text-green-700 select-none">
       Previous Purchases
      </h2>
     </header>
     <ul class="space-y-4" id="purchasesList">
      <!-- Purchased product cards inserted here dynamically -->
     </ul>
     <div class="text-center text-gray-600 mt-10" id="purchasesEmptyMessage">
      You have no previous purchases.
     </div>
    </section>
   </main>
  </div>
  <script>
   // Data storage keys
    const STORAGE_USERS = 'ecofinds_users';
    const STORAGE_PRODUCTS = 'ecofinds_products';
    const STORAGE_CURRENT_USER = 'ecofinds_current_user';
    const STORAGE_CART = 'ecofinds_cart';
    const STORAGE_PURCHASES = 'ecofinds_purchases';

    // Cached DOM elements
    const loginScreen = document.getElementById('loginScreen');
    const signUpScreen = document.getElementById('signUpScreen');
    const feedScreen = document.getElementById('feedScreen');
    const addProductScreen = document.getElementById('addProductScreen');
    const myListingsScreen = document.getElementById('myListingsScreen');
    const productDetailScreen = document.getElementById('productDetailScreen');
    const dashboardScreen = document.getElementById('dashboardScreen');
    const cartScreen = document.getElementById('cartScreen');
    const purchasesScreen = document.getElementById('purchasesScreen');

    const navLinks = document.querySelectorAll('.nav-link');
    const navLinksMobile = document.querySelectorAll('.nav-link-mobile');
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    const logoutBtn = document.getElementById('logoutBtn');
    const logoutBtnMobile = document.getElementById('logoutBtnMobile');
    const logoutBtnDashboard = document.getElementById('logoutBtnDashboard');

    const loginForm = document.getElementById('loginForm');
    const signUpForm = document.getElementById('signUpForm');
    const showSignUpBtn = document.getElementById('showSignUpBtn');
    const showLoginBtn = document.getElementById('showLoginBtn');

    const addNewProductBtn = document.getElementById('addNewProductBtn');
    const addNewProductBtnFromMyListings = document.getElementById('addNewProductBtnFromMyListings');
    const backFromAddProductBtn = document.getElementById('backFromAddProductBtn');
    const addProductForm = document.getElementById('addProductForm');
    const addImageBtn = document.getElementById('addImageBtn');
    const productImagePreview = document.getElementById('productImagePreview');

    const productList = document.getElementById('productList');
    const myProductList = document.getElementById('myProductList');

    const searchInput = document.getElementById('searchInput');
    const categoryFilter = document.getElementById('categoryFilter');

    const backFromProductDetailBtn = document.getElementById('backFromProductDetailBtn');
    const detailProductTitle = document.getElementById('detailProductTitle');
    const detailProductImage = document.getElementById('detailProductImage');
    const detailProductPrice = document.getElementById('detailProductPrice');
    const detailProductCategory = document.getElementById('detailProductCategory');
    const detailProductDescription = document.getElementById('detailProductDescription');
    const addToCartBtn = document.getElementById('addToCartBtn');

    const dashboardForm = document.getElementById('dashboardForm');
    const dashboardEmail = document.getElementById('dashboardEmail');
    const dashboardUsername = document.getElementById('dashboardUsername');
    const userAvatar = document.getElementById('userAvatar');

    const cartList = document.getElementById('cartList');
    const cartEmptyMessage = document.getElementById('cartEmptyMessage');
    const clearCartBtn = document.getElementById('clearCartBtn');

    const purchasesList = document.getElementById('purchasesList');
    const purchasesEmptyMessage = document.getElementById('purchasesEmptyMessage');

    // Mobile menu toggle
    mobileMenuBtn.addEventListener('click', () => {
      mobileMenu.classList.toggle('hidden');
    });

    // State variables
    let users = JSON.parse(localStorage.getItem(STORAGE_USERS)) || [];
    let products = JSON.parse(localStorage.getItem(STORAGE_PRODUCTS)) || [];
    let currentUser = JSON.parse(localStorage.getItem(STORAGE_CURRENT_USER)) || null;
    let cart = JSON.parse(localStorage.getItem(STORAGE_CART)) || [];
    let purchases = JSON.parse(localStorage.getItem(STORAGE_PURCHASES)) || [];

    // Current viewed product in detail screen
    let currentDetailProductId = null;

    // Utility functions
    function saveUsers() {
      localStorage.setItem(STORAGE_USERS, JSON.stringify(users));
    }
    function saveProducts() {
      localStorage.setItem(STORAGE_PRODUCTS, JSON.stringify(products));
    }
    function saveCurrentUser() {
      localStorage.setItem(STORAGE_CURRENT_USER, JSON.stringify(currentUser));
    }
    function saveCart() {
      localStorage.setItem(STORAGE_CART, JSON.stringify(cart));
    }
    function savePurchases() {
      localStorage.setItem(STORAGE_PURCHASES, JSON.stringify(purchases));
    }

    function showScreen(screen) {
      // Hide all screens
      [
        loginScreen,
        signUpScreen,
        feedScreen,
        addProductScreen,
        myListingsScreen,
        productDetailScreen,
        dashboardScreen,
        cartScreen,
        purchasesScreen,
      ].forEach(s => s.classList.add('hidden'));

      // Hide mobile menu on navigation
      mobileMenu.classList.add('hidden');

      // Show requested screen
      screen.classList.remove('hidden');

      // Scroll to top on screen change
      window.scrollTo({ top: 0, behavior: 'smooth' });

      // Update nav active states
      navLinks.forEach(link => {
        if (link.dataset.nav === screen.id.replace('Screen', '')) {
          link.classList.add('text-green-700', 'font-semibold');
          link.classList.remove('hover:text-green-700');
        } else {
          link.classList.remove('text-green-700', 'font-semibold');
          link.classList.add('hover:text-green-700');
        }
      });
      navLinksMobile.forEach(link => {
        if (link.dataset.nav === screen.id.replace('Screen', '')) {
          link.classList.add('bg-green-100', 'font-semibold');
          link.classList.remove('hover:bg-green-100');
        } else {
          link.classList.remove('bg-green-100', 'font-semibold');
          link.classList.add('hover:bg-green-100');
        }
      });
    }

    function validateEmail(email) {
      // Simple email regex
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function generateId() {
      return '_' + Math.random().toString(36).substr(2, 9);
    }

    // Authentication functions
    function login(email, password) {
      const user = users.find(u => u.email.toLowerCase() === email.toLowerCase());
      if (!user) return { success: false, message: 'User not found.' };
      if (user.password !== password) return { success: false, message: 'Incorrect password.' };
      currentUser = { email: user.email, username: user.username, id: user.id };
      saveCurrentUser();
      return { success: true };
    }

    function signUp(email, username, password) {
      if (users.find(u => u.email.toLowerCase() === email.toLowerCase())) {
        return { success: false, message: 'Email already registered.' };
      }
      if (users.find(u => u.username.toLowerCase() === username.toLowerCase())) {
        return { success: false, message: 'Username already taken.' };
      }
      const newUser = {
        id: generateId(),
        email,
        username,
        password,
      };
      users.push(newUser);
      saveUsers();
      currentUser = { email: newUser.email, username: newUser.username, id: newUser.id };
      saveCurrentUser();
      return { success: true };
    }

    function logout() {
      currentUser = null;
      saveCurrentUser();
      cart = [];
      saveCart();
      showScreen(loginScreen);
    }

    // Render functions
    function renderProductList() {
      productList.innerHTML = '';
      let filteredProducts = products;

      // Filter by category
      const category = categoryFilter.value;
      if (category) {
        filteredProducts = filteredProducts.filter(p => p.category === category);
      }

      // Filter by search keyword in title
      const keyword = searchInput.value.trim().toLowerCase();
      if (keyword) {
        filteredProducts = filteredProducts.filter(p => p.title.toLowerCase().includes(keyword));
      }

      if (filteredProducts.length === 0) {
        productList.innerHTML = `<li class="col-span-full text-center text-gray-600 py-10">No products found.</li>`;
        return;
      }

      filteredProducts.forEach(product => {
        const li = document.createElement('li');
        li.className = 'bg-white rounded-lg shadow-md overflow-hidden cursor-pointer hover:shadow-lg transition-shadow flex flex-col';
        li.tabIndex = 0;
        li.setAttribute('role', 'button');
        li.setAttribute('aria-label', `View details for product ${product.title}`);

        li.innerHTML = `
          <img
            src="${product.image}"
            alt="Placeholder image of product titled ${product.title}"
            class="w-full h-48 object-cover"
          />
          <div class="p-4 flex flex-col flex-grow">
            <h3 class="text-lg font-semibold text-gray-800 mb-2 truncate">${product.title}</h3>
            <p class="text-green-700 font-bold text-xl mt-auto">$${product.price.toFixed(2)}</p>
          </div>
        `;

        li.addEventListener('click', () => {
          openProductDetail(product.id);
        });
        li.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openProductDetail(product.id);
          }
        });

        productList.appendChild(li);
      });
    }

    function renderMyListings() {
      myProductList.innerHTML = '';
      if (!currentUser) return;
      const myProducts = products.filter(p => p.ownerId === currentUser.id);
      if (myProducts.length === 0) {
        myProductList.innerHTML = `<li class="col-span-full text-center text-gray-600 py-10">You have no listings.</li>`;
        return;
      }
      myProducts.forEach(product => {
        const li = document.createElement('li');
        li.className = 'bg-white rounded-lg shadow-md overflow-hidden flex flex-col';
        li.tabIndex = 0;

        li.innerHTML = `
          <img
            src="${product.image}"
            alt="Placeholder image of product titled ${product.title}"
            class="w-full h-48 object-cover"
          />
          <div class="p-4 flex flex-col flex-grow">
            <h3 class="text-lg font-semibold text-gray-800 mb-2 truncate">${product.title}</h3>
            <p class="text-green-700 font-bold text-xl mb-4">$${product.price.toFixed(2)}</p>
            <div class="mt-auto flex space-x-3">
              <button class="editBtn bg-yellow-400 hover:bg-yellow-500 text-white px-3 py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-300 flex items-center space-x-1" aria-label="Edit product ${product.title}">
                <i class="fas fa-edit"></i><span>Edit</span>
              </button>
              <button class="deleteBtn bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-red-400 flex items-center space-x-1" aria-label="Delete product ${product.title}">
                <i class="fas fa-trash-alt"></i><span>Delete</span>
              </button>
            </div>
          </div>
        `;

        // Edit button
        li.querySelector('.editBtn').addEventListener('click', e => {
          e.stopPropagation();
          openEditProduct(product.id);
        });

        // Delete button
        li.querySelector('.deleteBtn').addEventListener('click', e => {
          e.stopPropagation();
          if (confirm(`Are you sure you want to delete "${product.title}"?`)) {
            products = products.filter(p => p.id !== product.id);
            saveProducts();
            renderMyListings();
            renderProductList();
          }
        });

        myProductList.appendChild(li);
      });
    }

    function openProductDetail(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      currentDetailProductId = productId;
      detailProductTitle.textContent = product.title;
      detailProductImage.src = product.image;
      detailProductImage.alt = `Large placeholder image of product titled ${product.title}`;
      detailProductPrice.textContent = `$${product.price.toFixed(2)}`;
      detailProductCategory.textContent = product.category;
      detailProductDescription.textContent = product.description;
      showScreen(productDetailScreen);
    }

    function openEditProduct(productId) {
      const product = products.find(p => p.id === productId);
      if (!product) return;
      // Fill form with product data
      addProductForm.productTitle.value = product.title;
      addProductForm.productCategory.value = product.category;
      addProductForm.productDescription.value = product.description;
      addProductForm.productPrice.value = product.price;
      productImagePreview.src = product.image;
      productImagePreview.alt = `Placeholder image of product titled ${product.title}`;
      addProductForm.dataset.editing = productId;
      showScreen(addProductScreen);
    }

    function resetAddProductForm() {
      addProductForm.reset();
      productImagePreview.src = 'https://placehold.co/100x100/png?text=Image+Placeholder';
      productImagePreview.alt = 'Placeholder image for product to be added';
      delete addProductForm.dataset.editing;
    }

    function renderDashboard() {
      if (!currentUser) return;
      dashboardEmail.value = currentUser.email;
      dashboardUsername.value = currentUser.username;
      userAvatar.src = `https://placehold.co/100x100/png?text=${encodeURIComponent(currentUser.username.charAt(0).toUpperCase())}`;
      userAvatar.alt = `User avatar placeholder image with letter ${currentUser.username.charAt(0).toUpperCase()}`;
    }

    function renderCart() {
      cartList.innerHTML = '';
      if (cart.length === 0) {
        cartEmptyMessage.classList.remove('hidden');
        return;
      }
      cartEmptyMessage.classList.add('hidden');
      cart.forEach(item => {
        const product = products.find(p => p.id === item.productId);
        if (!product) return;
        const li = document.createElement('li');
        li.className = 'bg-white rounded-lg shadow-md p-4 flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-6';

        li.innerHTML = `
          <img
            src="${product.image}"
            alt="Placeholder image of product titled ${product.title}"
            class="w-32 h-32 object-cover rounded-md flex-shrink-0"
          />
          <div class="flex-grow w-full">
            <h3 class="text-lg font-semibold text-gray-800">${product.title}</h3>
            <p class="text-green-700 font-bold text-xl">$${product.price.toFixed(2)}</p>
          </div>
          <button class="removeBtn bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-md focus:outline-none focus:ring-2 focus:ring-red-400" aria-label="Remove ${product.title} from cart">
            <i class="fas fa-trash-alt"></i>
          </button>
        `;

        li.querySelector('.removeBtn').addEventListener('click', () => {
          cart = cart.filter(c => c.productId !== product.id);
          saveCart();
          renderCart();
        });

        cartList.appendChild(li);
      });
    }

    function renderPurchases() {
      purchasesList.innerHTML = '';
      if (!currentUser) {
        purchasesEmptyMessage.classList.remove('hidden');
        return;
      }
      const userPurchases = purchases.filter(p => p.userId === currentUser.id);
      if (userPurchases.length === 0) {
        purchasesEmptyMessage.classList.remove('hidden');
        return;
      }
      purchasesEmptyMessage.classList.add('hidden');
      userPurchases.forEach(purchase => {
        const product = products.find(p => p.id === purchase.productId);
        if (!product) return;
        const li = document.createElement('li');
        li.className = 'bg-white rounded-lg shadow-md p-4 flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-6';

        li.innerHTML = `
          <img
            src="${product.image}"
            alt="Placeholder image of previously purchased product titled ${product.title}"
            class="w-32 h-32 object-cover rounded-md flex-shrink-0"
          />
          <div class="flex-grow w-full">
            <h3 class="text-lg font-semibold text-gray-800">${product.title}</h3>
            <p class="text-green-700 font-bold text-xl">$${product.price.toFixed(2)}</p>
          </div>
        `;

        purchasesList.appendChild(li);
      });
    }

    // Event listeners

    // Navigation links desktop
    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        if (!currentUser) {
          alert('Please log in first.');
          showScreen(loginScreen);
          return;
        }
        switch (link.dataset.nav) {
          case 'feed':
            renderProductList();
            showScreen(feedScreen);
            break;
          case 'mylistings':
            renderMyListings();
            showScreen(myListingsScreen);
            break;
          case 'dashboard':
            renderDashboard();
            showScreen(dashboardScreen);
            break;
          case 'cart':
            renderCart();
            showScreen(cartScreen);
            break;
          case 'purchases':
            renderPurchases();
            showScreen(purchasesScreen);
            break;
        }
      });
    });

    // Navigation links mobile
    navLinksMobile.forEach(link => {
      link.addEventListener('click', () => {
        if (!currentUser) {
          alert('Please log in first.');
          showScreen(loginScreen);
          return;
        }
        switch (link.dataset.nav) {
          case 'feed':
            renderProductList();
            showScreen(feedScreen);
            break;
          case 'mylistings':
            renderMyListings();
            showScreen(myListingsScreen);
            break;
          case 'dashboard':
            renderDashboard();
            showScreen(dashboardScreen);
            break;
          case 'cart':
            renderCart();
            showScreen(cartScreen);
            break;
          case 'purchases':
            renderPurchases();
            showScreen(purchasesScreen);
            break;
        }
      });
    });

    // Logout buttons
    logoutBtn.addEventListener('click', logout);
    logoutBtnMobile.addEventListener('click', logout);
    logoutBtnDashboard.addEventListener('click', logout);

    // Show sign up screen
    showSignUpBtn.addEventListener('click', () => {
      loginForm.reset();
      showScreen(signUpScreen);
    });

    // Show login screen
    showLoginBtn.addEventListener('click', () => {
      signUpForm.reset();
      showScreen(loginScreen);
    });

    // Login form submit
    loginForm.addEventListener('submit', e => {
      e.preventDefault();
      const email = loginForm.email.value.trim();
      const password = loginForm.password.value;
      if (!validateEmail(email)) {
        alert('Please enter a valid email.');
        return;
      }
      if (!password) {
        alert('Please enter your password.');
        return;
      }
      const result = login(email, password);
      if (!result.success) {
        alert(result.message);
        return;
      }
      loginForm.reset();
      renderProductList();
      showScreen(feedScreen);
    });

    // Sign up form submit
    signUpForm.addEventListener('submit', e => {
      e.preventDefault();
      const email = signUpForm.signupEmail.value.trim();
      const username = signUpForm.signupUsername.value.trim();
      const password = signUpForm.signupPassword.value;
      if (!validateEmail(email)) {
        alert('Please enter a valid email.');
        return;
      }
      if (username.length < 3) {
        alert('Username must be at least 3 characters.');
        return;
      }
      if (password.length < 6) {
        alert('Password must be at least 6 characters.');
        return;
      }
      const result = signUp(email, username, password);
      if (!result.success) {
        alert(result.message);
        return;
      }
      signUpForm.reset();
      renderProductList();
      showScreen(feedScreen);
    });

    // Add new product button (feed)
    addNewProductBtn.addEventListener('click', () => {
      resetAddProductForm();
      showScreen(addProductScreen);
    });

    // Add new product button (my listings)
    addNewProductBtnFromMyListings.addEventListener('click', () => {
      resetAddProductForm();
      showScreen(addProductScreen);
    });

    // Back button from add product screen
    backFromAddProductBtn.addEventListener('click', () => {
      if (addProductForm.dataset.editing) {
        renderMyListings();
        showScreen(myListingsScreen);
      } else {
        renderProductList();
        showScreen(feedScreen);
      }
      resetAddProductForm();
    });

    // Add image button (placeholder)
    addImageBtn.addEventListener('click', () => {
      // For this prototype, just cycle through some placeholder images
      const placeholders = [
        'https://placehold.co/100x100/png?text=Image+Placeholder',
        'https://placehold.co/100x100/png?text=Eco+Item+1',
        'https://placehold.co/100x100/png?text=Eco+Item+2',
        'https://placehold.co/100x100/png?text=Eco+Item+3',
      ];
      const currentIndex = placeholders.indexOf(productImagePreview.src);
      const nextIndex = (currentIndex + 1) % placeholders.length;
      productImagePreview.src = placeholders[nextIndex];
      productImagePreview.alt = `Placeholder image for product to be added, variant ${nextIndex + 1}`;
    });

    // Add product form submit
    addProductForm.addEventListener('submit', e => {
      e.preventDefault();
      if (!currentUser) {
        alert('Please log in first.');
        showScreen(loginScreen);
        return;
      }
      const title = addProductForm.productTitle.value.trim();
      const category = addProductForm.productCategory.value;
      const description = addProductForm.productDescription.value.trim();
      const price = parseFloat(addProductForm.productPrice.value);
      const image = productImagePreview.src;

      if (!title || !category || !description || isNaN(price) || price < 0) {
        alert('Please fill all fields correctly.');
        return;
      }

      if (addProductForm.dataset.editing) {
        // Edit existing product
        const productId = addProductForm.dataset.editing;
        const productIndex = products.findIndex(p => p.id === productId);
        if (productIndex === -1) {
          alert('Product not found.');
          return;
        }
        if (products[productIndex].ownerId !== currentUser.id) {
          alert('You can only edit your own products.');
          return;
        }
        products[productIndex].title = title;
        products[productIndex].category = category;
        products[productIndex].description = description;
        products[productIndex].price = price;
        products[productIndex].image = image;
        saveProducts();
        renderMyListings();
        showScreen(myListingsScreen);
        resetAddProductForm();
      } else {
        // Add new product
        const newProduct = {
          id: generateId(),
          ownerId: currentUser.id,
          title,
          category,
          description,
          price,
          image,
        };
        products.push(newProduct);
        saveProducts();
        renderProductList();
        showScreen(feedScreen);
        resetAddProductForm();
      }
    });

    // Search and filter events
    searchInput.addEventListener('input', () => {
      renderProductList();
    });
    categoryFilter.addEventListener('change', () => {
      renderProductList();
    });

    // Back button from product detail screen
    backFromProductDetailBtn.addEventListener('click', () => {
      renderProductList();
      showScreen(feedScreen);
    });

    // Add to cart button
    addToCartBtn.addEventListener('click', () => {
      if (!currentUser) {
        alert('Please log in first.');
        showScreen(loginScreen);
        return;
      }
      if (!currentDetailProductId) return;
      if (cart.find(c => c.productId === currentDetailProductId)) {
        alert('Product already in cart.');
        return;
      }
      cart.push({ productId: currentDetailProductId });
      saveCart();
      alert('Product added to cart.');
    });

    // Dashboard form submit
    dashboardForm.addEventListener('submit', e => {
      e.preventDefault();
      if (!currentUser) return;
      const newUsername = dashboardUsername.value.trim();
      if (newUsername.length < 3) {
        alert('Username must be at least 3 characters.');
        return;
      }
      // Check if username taken by others
      if (users.find(u => u.username.toLowerCase() === newUsername.toLowerCase() && u.id !== currentUser.id)) {
        alert('Username already taken.');
        return;
      }
      // Update user in users array
      const userIndex = users.findIndex(u => u.id === currentUser.id);
      if (userIndex === -1) return;
      users[userIndex].username = newUsername;
      saveUsers();
      currentUser.username = newUsername;
      saveCurrentUser();
      alert('Profile updated.');
      renderDashboard();
    });

    // Clear cart button
    clearCartBtn.addEventListener('click', () => {
      if (confirm('Are you sure you want to clear the cart?')) {
        cart = [];
        saveCart();
        renderCart();
      }
    });

    // On page load
    function init() {
      if (currentUser) {
        renderProductList();
        showScreen(feedScreen);
      } else {
        showScreen(loginScreen);
      }
    }

    init();
  </script>
 </body>
</html>
